﻿
@model ThuVien.Models.DashboardViewModel
@{
    ViewBag.Title = "Trang Chủ";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Start Status area -->
<div class="notika-status-area">
    <div class="container">
        <div class="row">
            <div class="col-lg-3 col-md-6 col-sm-6 col-xs-12">
                <div class="wb-traffic-inner notika-shadow sm-res-mg-t-30 tb-res-mg-t-30">
                    <div class="website-traffic-ctn">
                        <h2><span class="counter">@Model.TotalSach</span></h2>
                        <p>Tổng Số Sách</p>
                    </div>
                    <div class="sparkline-bar-stats1">9,4,8,6,5,6,4,8,3,5,9,5</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6 col-xs-12">
                <div class="wb-traffic-inner notika-shadow sm-res-mg-t-30 tb-res-mg-t-30">
                    <div class="website-traffic-ctn">
                        <h2><span class="counter">@Model.TotalSinhVien</span></h2>
                        <p>Tổng Số Sinh Viên</p>
                    </div>
                    <div class="sparkline-bar-stats2">1,4,8,3,5,6,4,8,3,3,9,5</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6 col-xs-12">
                <div class="wb-traffic-inner notika-shadow sm-res-mg-t-30 tb-res-mg-t-30 dk-res-mg-t-30">
                    <div class="website-traffic-ctn">
                        <h2><span class="counter">@Model.TotalPhieuMuon</span></h2>
                        <p>Tổng Số Phiếu Mượn</p>
                    </div>
                    <div class="sparkline-bar-stats3">4,2,8,2,5,6,3,8,3,5,9,5</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6 col-xs-12">
                <div class="wb-traffic-inner notika-shadow sm-res-mg-t-30 tb-res-mg-t-30 dk-res-mg-t-30">
                    <div class="website-traffic-ctn">
                        <h2><span class="counter">@Model.TotalSachDangMuon</span></h2>
                        <p>Sách Đang Mượn</p>
                    </div>
                    <div class="sparkline-bar-stats4">2,4,8,4,5,7,4,7,3,5,7,5</div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End Status area-->
<!-- Start Sale Statistic area-->
<div class="sale-statistic-area">
    <div class="container">
        <div class="row">
            <div class="col-lg-9 col-md-8 col-sm-7 col-xs-12">
                <div class="sale-statistic-inner notika-shadow mg-tb-30">
                    <div class="curved-inner-pro">
                        <div class="curved-ctn">
                            <h2>Thống Kê Mượn Sách</h2>
                            <p>Biểu đồ thống kê số lượng sách mượn trong hệ thống</p>
                        </div>
                    </div>
                    <div id="curved-line-chart" class="flot-chart-sts flot-chart"></div>
                </div>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-5 col-xs-12">
                <div class="statistic-right-area notika-shadow mg-tb-30 sm-res-mg-t-0">
                    <div class="past-day-statis">
                        <h2>30 Ngày Qua</h2>
                        <p>Thống kê hoạt động mượn sách trong 30 ngày gần đây</p>
                    </div>
                    <div class="dash-widget-visits"></div>
                    <div class="past-statistic-an">
                        <div class="past-statistic-ctn">
                            <h3><span class="counter">@Model.PhieuMuon30Ngay</span></h3>
                            <p>Phiếu Mượn</p>
                        </div>
                        <div class="past-statistic-graph">
                            <div class="stats-bar"></div>
                        </div>
                    </div>
                    <div class="past-statistic-an">
                        <div class="past-statistic-ctn">
                            <h3><span class="counter">@Model.SachMuon30Ngay</span></h3>
                            <p>Sách Đã Mượn</p>
                        </div>
                        <div class="past-statistic-graph">
                            <div class="stats-line"></div>
                        </div>
                    </div>
                    <div class="past-statistic-an">
                        <div class="past-statistic-ctn">
                            <h3><span class="counter">@Model.SinhVienMoi30Ngay</span></h3>
                            <p>Sinh Viên Mới</p>
                        </div>
                        <div class="past-statistic-graph">
                            <div class="stats-bar-2"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End Sale Statistic area-->
<!-- Start Email Statistic area-->
<div class="notika-email-post-area">
    <div class="container">
        <div class="row">
            <div class="col-lg-4 col-md-6 col-sm-6 col-xs-12">
                <div class="email-statis-inner notika-shadow">
                    <div class="email-ctn-round">
                        <div class="email-rdn-hd">
                            <h2>Thống Kê Sách</h2>
                        </div>
                        <div class="email-statis-wrap">
                            <div class="email-round-nock">
                                @{
                                    var tyLeMuon = Model.TotalSach > 0 ? (int)((double)Model.TotalSachDangMuon / Model.TotalSach * 100) : 0;
                                }
                                <input type="text" class="knob" value="0" data-rel="@tyLeMuon" data-linecap="round" data-width="130" data-bgcolor="#E4E4E4" data-fgcolor="#00c292" data-thickness=".10" data-readonly="true">
                            </div>
                            <div class="email-ctn-nock">
                                <p>Tỷ Lệ Sách Đang Mượn</p>
                            </div>
                        </div>
                        <div class="email-round-gp">
                            <div class="email-round-pro">
                                <div class="email-signle-gp">
                                    @{
                                        var tyLeSach = Model.TotalSach > 0 ? (int)((double)Model.TotalSachDangMuon / Model.TotalSach * 100) : 0;
                                    }
                                    <input type="text" class="knob" value="0" data-rel="@tyLeSach" data-linecap="round" data-width="90" data-bgcolor="#E4E4E4" data-fgcolor="#00c292" data-thickness=".10" data-readonly="true" disabled>
                                </div>
                                <div class="email-ctn-nock">
                                    <p>Sách Đang Mượn</p>
                                </div>
                            </div>
                            <div class="email-round-pro">
                                <div class="email-signle-gp">
                                    @{
                                        var tyLeConLai = Model.TotalSach > 0 ? (int)((double)(Model.TotalSach - Model.TotalSachDangMuon) / Model.TotalSach * 100) : 0;
                                    }
                                    <input type="text" class="knob" value="0" data-rel="@tyLeConLai" data-linecap="round" data-width="90" data-bgcolor="#E4E4E4" data-fgcolor="#00c292" data-thickness=".10" data-readonly="true" disabled>
                                </div>
                                <div class="email-ctn-nock">
                                    <p>Sách Còn Lại</p>
                                </div>
                            </div>
                            <div class="email-round-pro sm-res-ds-n lg-res-mg-bl">
                                <div class="email-signle-gp">
                                    @{
                                        var tyLePhieuMuon = Model.TotalSinhVien > 0 ? (int)((double)Model.TotalPhieuMuon / Model.TotalSinhVien * 100) : 0;
                                        if (tyLePhieuMuon > 100) { tyLePhieuMuon = 100; }
                                    }
                                    <input type="text" class="knob" value="0" data-rel="@tyLePhieuMuon" data-linecap="round" data-width="90" data-bgcolor="#E4E4E4" data-fgcolor="#00c292" data-thickness=".10" data-readonly="true" disabled>
                                </div>
                                <div class="email-ctn-nock">
                                    <p>Tỷ Lệ Mượn</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6 col-sm-6 col-xs-12">
                <div class="recent-post-wrapper notika-shadow sm-res-mg-t-30 tb-res-ds-n dk-res-ds">
                    <div class="recent-post-ctn">
                        <div class="recent-post-title">
                            <h2>Phiếu Mượn Gần Đây</h2>
                        </div>
                    </div>
                    <div class="recent-post-items">
                        @if (Model.RecentPhieuMuons != null && Model.RecentPhieuMuons.Any())
                        {
                            var index = 0;
                            foreach (var phieuMuon in Model.RecentPhieuMuons)
                            {
                                index++;
                                <div class="recent-post-signle @(index == 1 ? "rct-pt-mg-wp" : "")">
                                    <a href="@Url.Action("Index", "PhieuMuon")">
                                        <div class="recent-post-flex @(index > 1 ? "rct-pt-mg" : "")">
                                            <div class="recent-post-img">
                                                <img src="~/Assets/img/post/@(Math.Abs(phieuMuon.MaMuon.GetHashCode()) % 4 + 1).jpg" alt="" />
                                            </div>
                                            <div class="recent-post-it-ctn">
                                                <h2>@phieuMuon.TenSinhVien</h2>
                                                <p>Mã phiếu: @phieuMuon.MaMuon - Số sách: @phieuMuon.SoSach</p>
                                                <small>Ngày mượn: @(phieuMuon.NgayMuon?.ToString("dd/MM/yyyy") ?? "N/A")</small>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                            }
                        }
                        else
                        {
                            <div class="recent-post-signle rct-pt-mg-wp">
                                <div class="recent-post-flex">
                                    <div class="recent-post-it-ctn">
                                        <p>Chưa có phiếu mượn nào</p>
                                    </div>
                                </div>
                            </div>
                        }
                        <div class="recent-post-signle">
                            <a href="@Url.Action("Index", "PhieuMuon")">
                                <div class="recent-post-flex rc-ps-vw">
                                    <div class="recent-post-line rct-pt-mg">
                                        <p>Xem Tất Cả</p>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6 col-sm-6 col-xs-12">
                <div class="recent-items-wp notika-shadow sm-res-mg-t-30">
                    <div class="rc-it-ltd">
                        <div class="recent-items-ctn">
                            <div class="recent-items-title">
                                <h2>Sách Mượn Nhiều Nhất</h2>
                            </div>
                        </div>
                        <div class="recent-items-inn">
                            <table class="table table-inner table-vmiddle">
                                <thead>
                                    <tr>
                                        <th>Mã Sách</th>
                                        <th>Tên Sách</th>
                                        <th style="width: 80px">Số Lượt</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @if (Model.TopSachMuon != null && Model.TopSachMuon.Any())
                                    {
                                        foreach (var sach in Model.TopSachMuon)
                                        {
                                            <tr>
                                                <td class="f-500 c-cyan">@sach.MaSach</td>
                                                <td>@(sach.TenSach ?? "N/A")</td>
                                                <td class="f-500 c-cyan">@sach.SoLuongMuon</td>
                                            </tr>
                                        }
                                    }
                                    else
                                    {
                                        <tr>
                                            <td colspan="3" class="text-center">Chưa có dữ liệu</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                        <div id="recent-items-chart" class="flot-chart-items flot-chart vt-ct-it tb-rc-it-res"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End Email Statistic area-->